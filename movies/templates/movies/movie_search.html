<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì˜í™” ê²€ìƒ‰</title>
    <style>
    body { font-family: 'Noto Sans KR', sans-serif; margin: 20px; }
    .search-form { 
        /* background: #f5f5f5; */ /* ë°°ê²½ìƒ‰ ì œê±° */
        padding: 20px; 
        border-top: 1px solid #afafaf;    /* ìƒë‹¨ êµ¬ë¶„ì„  ì§„í•˜ê²Œ */
        border-bottom: 1px solid #afafaf; /* í•˜ë‹¨ êµ¬ë¶„ì„  ì§„í•˜ê²Œ */
        margin-bottom: 20px; 
    }
    .form-grid { 
        display: grid; 
        grid-template-columns: auto 2fr 1fr auto 2fr auto 1fr auto 1fr auto; 
        grid-template-rows: repeat(5, auto);
        gap: 10px 20px; 
        align-items: center; 
    }
    .form-label { font-weight: bold; white-space: nowrap; font-family: 'Noto Sans KR', sans-serif; }
    .form-input input, .form-input select, .form-input div { 
        width: 100%; 
        font-family: 'Noto Sans KR', sans-serif; 
    }
    .form-input input[type="text"], .form-input select{
        border: 1px solid #d7d7d7; 
        padding: 5px;
    }
    .date-input-group {position: relative; display: flex; align-items: center; gap: 2px; flex: 1; }
    /* .date-input-group input[type="text"] { 
        flex: 1; 
        padding: 5px; 
        border: 1px solid #ddd; 
        font-family: 'Noto Sans KR', sans-serif; 
    } */
    .hidden-date-input { 
        position: absolute;
        width: 1%;
        opacity: 0;
        z-index: -1;
    }
    .calendar-btn { 
        width: 30px; 
        height: 30px; 
        border: 1px solid #ddd; 
        cursor: pointer;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-family: 'Noto Sans KR', sans-serif;
    }
    .calendar-btn:hover {
        background: #e0e0e0;
    }
    .date-range { display: flex; align-items: center; gap: 5px; }
    .date-range span { flex-shrink: 0; font-family: 'Noto Sans KR', sans-serif; }
    .year-range { display: flex; align-items: center; gap: 5px; }
    .button-group { 
        display: flex; 
        gap: 5px; 
        grid-row: 1 / 3; 
        grid-column: 10; 
        align-self: center;
    }
    .separator { grid-column: 1 / -1; border-top: 1px dotted #999; margin: 10px 0; }
    .index-section { grid-column: 1 / -1; display: flex; align-items: flex-start; margin-top: 10px; }
    .index-section label { 
        width: 120px; 
        flex-shrink: 0; 
        font-family: 'Noto Sans KR', sans-serif; 
    }
    .index-links { display: flex; flex-wrap: wrap; margin-left: 10px; gap: 2px; width: 100%;}
    .index-links a { 
        text-decoration: none; 
        padding: 4px 8px; 
        font-size: 14px; 
        flex-shrink: 0; 
        font-family: 'Noto Sans KR', sans-serif; 
        border: 1px solid transparent;
        border-radius: 3px;
        text-decoration: none; 
        color: inherit;
    }
    .index-links a:hover { 
        background: #e0e0e0; 
    }
    .index-links a.active {
        background: #5076db;
        color: white;
        border: 1px solid #5076db;
        font-weight: bold;
        border-radius: 50%; /* ì›í˜•ìœ¼ë¡œ ë³€ê²½ */
    }
    .results-table { 
        width: 100%; 
        border-collapse: collapse; 
        margin-top: 20px; 
        border-left: none;
        border-right: none;
        font-family: 'Noto Sans KR', sans-serif;
        border-bottom: 2px solid #666;
        table-layout: fixed;
        min-width: 1200px; /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
    }
    
    /* colgroupì„ ì‚¬ìš©í•œ ì—´ ë„ˆë¹„ ì •ì˜ */
    .results-table colgroup col:nth-child(1) { width: 18%; } /* ì˜í™”ëª… */
    .results-table colgroup col:nth-child(2) { width: 15%; } /* ì˜í™”ëª…(ì˜ë¬¸) */
    .results-table colgroup col:nth-child(3) { width: 8%; }  /* ì˜í™”ì½”ë“œ */
    .results-table colgroup col:nth-child(4) { width: 6%; }  /* ì œì‘ì—°ë„ */
    .results-table colgroup col:nth-child(5) { width: 8%; }  /* ì œì‘êµ­ê°€ */
    .results-table colgroup col:nth-child(6) { width: 8%; }  /* ìœ í˜• */
    .results-table colgroup col:nth-child(7) { width: 12%; } /* ì¥ë¥´ */
    .results-table colgroup col:nth-child(8) { width: 8%; }  /* ì œì‘ìƒíƒœ */
    .results-table colgroup col:nth-child(9) { width: 9%; }  /* ê°ë… */
    .results-table colgroup col:nth-child(10) { width: 8%; } /* ì œì‘ì‚¬ */
    .results-table th, .results-table td { 
        border-top: 1px solid #ddd; 
        border-bottom: 1px solid #ddd; 
        border-left: none;
        border-right: none;
        padding: 8px; 
        font-family: 'Noto Sans KR', sans-serif;
        font-size: 12px;
        word-wrap: break-word;
        overflow: hidden;
        vertical-align: middle;
    }
    
    /* ì˜í™”ëª…(1ì—´) - ì¢Œì¸¡ ì •ë ¬ */
    .results-table td:nth-child(1) {
        text-align: left;
        white-space: normal;
        word-wrap: break-word;
        line-height: 1.4;
    }
    
    /* ì˜í™”ëª… ì˜ë¬¸(2ì—´) - ì¢Œì¸¡ ì •ë ¬ */
    .results-table td:nth-child(2) {
        text-align: left;
        white-space: normal;
        word-wrap: break-word;
        line-height: 1.4;
    }
    
    /* ì˜í™”ì½”ë“œ(3ì—´) - ì¤‘ì•™ ì •ë ¬ */
    .results-table td:nth-child(3) {
        text-align: center;
    }
    
    /* ì œì‘ì—°ë„(4ì—´) - ì¤‘ì•™ ì •ë ¬ */
    .results-table td:nth-child(4) {
        text-align: center;
    }
    
    /* ì œì‘êµ­ê°€(5ì—´) - ì¤‘ì•™ ì •ë ¬ */
    .results-table td:nth-child(5) {
        text-align: center;
    }
    
    /* ìœ í˜•(6ì—´) - ì¤‘ì•™ ì •ë ¬ */
    .results-table td:nth-child(6) {
        text-align: center;
    }
    
    /* ì¥ë¥´(7ì—´) - ì¤‘ì•™ ì •ë ¬ */
    .results-table td:nth-child(7) {
        text-align: center;
    }
    
    /* ì œì‘ìƒíƒœ(8ì—´) - ì¤‘ì•™ ì •ë ¬ */
    .results-table td:nth-child(8) {
        text-align: center;
    }
    
    /* ê°ë…(9ì—´) - ì¤‘ì•™ ì •ë ¬ */
    .results-table td:nth-child(9) {
        text-align: center;
    }
    
    /* ì œì‘ì‚¬(10ì—´) - ì¤‘ì•™ ì •ë ¬ */
    .results-table td:nth-child(10) {
        text-align: center;
    }
    
    /* í—¤ë”ëŠ” ëª¨ë‘ ì¤‘ì•™ ì •ë ¬ */
    .results-table th { 
        background: #f0f0f0; 
        font-family: 'Noto Sans KR', sans-serif; 
        border-top: 2px solid #5076db;
        border-bottom: 2px solid #666;
        text-align: center;
        font-weight: bold;
    }
    /* ì…€ ê°„ êµ¬ë¶„ì„ ë§Œ ìœ ì§€ */
    .results-table th:not(:last-child), 
    .results-table td:not(:last-child) { 
        border-right: 1px solid #ddd; 
    }
    .results-table th { 
        background: #f0f0f0; font-family: 
        'Noto Sans KR', sans-serif; 
        border-top: 2px solid #5076db; /* ìƒë‹¨ í…Œë‘ë¦¬ íŒŒë€ìƒ‰ìœ¼ë¡œ ì¶”ê°€ */ 
        border-bottom: 2px solid #666; /* í•˜ë‹¨ í…Œë‘ë¦¬ íšŒìƒ‰ìœ¼ë¡œ ì¶”ê°€ */ 
        text-align: center;
    }
    /* ê²©ì¤„ ë°°ê²½ìƒ‰ ì¶”ê°€ */
    .results-table tr:nth-child(even) { background-color: #f9f9f9; }
    .results-table tr:nth-child(odd) { background-color: white; }
    .results-table tr:hover { background-color: #e8f4fd; } /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ íš¨ê³¼ */
    .pagination { 
        text-align: center; 
        margin-top: 20px; 
        font-family: 'Noto Sans KR', sans-serif; 
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 2px;
    }
    .pagination a, .pagination span { 
        display: inline-block;
        padding: 8px 12px;
        margin: 0;
        text-decoration: none; 
        font-family: 'Noto Sans KR', sans-serif;
        color: #333;
        background: white;
        min-width: 20px;
        text-align: center;
        font-size: 14px;
    }
    .pagination .nav-btn {
        border: 1px solid #ddd; 
    }
    .pagination a:hover {
        background: #f5f5f5;
    }
    .pagination .current {
        background: white;
        color: #333;
        border-color: #ddd;
        font-weight: bold;
        text-decoration: underline;
    }
    .pagination .nav-btn {
        padding: 8px 8px;
        font-size: 12px;
        color: #666;
    }
    .pagination .nav-btn:hover {
        background: #f5f5f5;
    }
    .pagination .nav-btn.disabled {
        color: #ccc;
        cursor: not-allowed;
        background: #f9f9f9;
    }
    .pagination .dots {
        border: none;
        background: none;
        padding: 8px 4px;
    }

    #query-button {
        background: #5076db;
        color: white;
        border: none;
        width: 70px;
        height: 48px;
        font-size: 14px;
        font-family: 'Noto Sans KR', sans-serif;
    }
    #query-button:hover {
        cursor: pointer;
    }

    #reset-button {
        background: #626262; 
        color: white; 
        border: none; 
        width: 70px; 
        height: 48px; 
        font-size: 14px; 
        font-family: 'Noto Sans KR', sans-serif;
        
    }
    #reset-button:hover {
        cursor: pointer;
    }
    /* ì¡°íšŒ ì‹œê°„ í‘œì‹œ ìŠ¤íƒ€ì¼ */
    .query-info { 
        position: fixed; 
        bottom: 20px; 
        right: 20px; 
        background: #f0f0f0; 
        padding: 10px; 
        border: 1px solid #ddd; 
        border-radius: 5px; 
        font-size: 12px; 
        color: #666; 
        font-family: 'Noto Sans KR', sans-serif; 
    }
    
    /* íŒì—… ìŠ¤íƒ€ì¼ */
    .popup-overlay { 
        display: none; 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(0,0,0,0.5); 
        z-index: 1000; 
    }
    .popup-content { 
        position: absolute; 
        background: white; 
        width: 520px; 
        max-height: 400px; 
        border-radius: 4px; 
        font-family: 'Noto Sans KR', sans-serif;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        border: 1px solid #ddd;
        padding: 20px;
    }
    .popup-header { 
        padding-bottom: 20px;
        border-bottom: 1px solid #dee2e6; 
        font-family: 'Noto Sans KR', sans-serif; 
        font-size: 16px;
        font-weight: 500;
        color: #5076db;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .popup-body { 
        max-height: 280px; 
        overflow-y: auto; 
        font-family: 'Noto Sans KR', sans-serif; 
    }
    .checkbox-header {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        padding: 10px 0;
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 15px;
        background: #f8f9fa;
        font-weight: 500;
        color: #495057;
        text-align: center;
    }
    .checkbox-header div {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 10px;
        align-items: center;
        padding: 0 10px;
    }
    .popup-close { 
        cursor: pointer; 
        font-size: 24px; 
        font-family: 'Noto Sans KR', sans-serif; 
        color: #6c757d;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 2px;
    }
    .popup-close:hover {
        background: #e9ecef;
        color: #495057;
    }
    .checkbox-grid { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 8px 20px; 
        margin-top: 15px;
        border: 1px solid #dee2e6;
    }
    .checkbox-item { 
        display: flex; 
        align-items: center; 
        padding: 8px 0;
        font-family: 'Noto Sans KR', sans-serif; 
        border-bottom: 1px solid #f1f3f4;
    }
    .checkbox-item:last-child {
        border-bottom: none;
    }
    .checkbox-item input { 
        margin-right: 10px; 
        width: 16px;
        height: 16px;
        accent-color: #6c5ce7;
    }
    .checkbox-item label { 
        font-family: 'Noto Sans KR', sans-serif; 
        font-size: 14px;
        color: #333;
        cursor: pointer;
        flex: 1;
    }
    .select-all-section {
        padding: 12px 0;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .select-all-section .left-side {
        display: flex;
        align-items: center;
    }
    .select-all-section input {
        margin-right: 10px;
        width: 16px;
        height: 16px;
        accent-color: #6c5ce7;
    }
    .select-all-section label {
        font-weight: 500;
        color: #495057;
        cursor: pointer;
    }
    .confirm-btn {
        background: #5076db;
        color: white;
        border: none;
        padding: 6px 16px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        font-family: 'Noto Sans KR', sans-serif;
        transition: background 0.2s ease;
    }
    /* íŒì—… í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .popup-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        border: 1px solid #dee2e6;
    }
    .popup-table th {
        background: #f8f9fa;
        padding: 10px;
        border: none;
        border-top: 1px solid #000; /* ìƒë‹¨ í…Œë‘ë¦¬ íŒŒë€ìƒ‰ìœ¼ë¡œ ì¶”ê°€ */
        font-weight: 500;
        color: #495057;
        text-align: center;
        font-size: 14px;
    }
    .popup-table td {
        padding: 8px 10px;
        border: 1px solid #dee2e6;
        font-size: 14px;
    }
    .popup-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    .popup-table tr:hover {
        background-color: #e8f4fd;
    }
    .popup-table input[type="checkbox"] {
        margin: 0;
        width: 16px;
        height: 16px;
        accent-color: #6c5ce7;
    }
    .popup-table label {
        font-family: 'Noto Sans KR', sans-serif;
        font-size: 14px;
        color: #333;
        cursor: pointer;
        margin: 0;
    }
    </style>
</head>
<body>
    <h1>ì˜í™”ì •ë³´</h1>
    
    <form method="get" class="search-form">
        <div class="form-grid">
            <!-- Row 1 -->
            <label class="form-label">â€¢ ì˜í™”ëª…</label>
            <div class="form-input">
                <input type="text" name="q" value="{{ query }}" placeholder="ì˜í™”ëª…">
            </div>
            
            <div></div> <!-- ê°„ê²© -->
            
            <label class="form-label">â€¢ ê°ë…ëª…</label>
            <div class="form-input">
                <input type="text" name="director" value="{{ director }}" placeholder="ê°ë…ëª…">
            </div>
            
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            
            <!-- ë²„íŠ¼ ê·¸ë£¹ (1-2í–‰ ì¤‘ê°„ì— ìœ„ì¹˜) -->
            <div class="button-group">
                <button type="submit" id="query-button">ì¡°íšŒ</button>
                <a href="{% url 'movie_search' %}">
                    <button type="button" id="reset-button">ì´ˆê¸°í™”</button>
                </a>
            </div>
            
            <!-- Row 2 -->
            <label class="form-label">â€¢ ì œì‘ì—°ë„</label>
            <div class="form-input">
                <div class="year-range">
                    <select name="year_start">
                        <option value="">--ì „ì²´--</option>
                        {% for y in year_range %}
                            <option value="{{ y }}" {% if year_start == y|stringformat:"s" %}selected{% endif %}>{{ y }}</option>
                        {% endfor %}
                    </select>
                    <span>~</span>
                    <select name="year_end">
                        <option value="">--ì „ì²´--</option>
                        {% for y in year_range %}
                            <option value="{{ y }}" {% if year_end == y|stringformat:"s" %}selected{% endif %}>{{ y }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div></div> <!-- ê°„ê²© -->
            
            <!-- <label class="form-label">â€¢ ì œì‘ì¼ì</label>
            <div class="form-input">
                <div class="date-range">
                    <div class="date-input-group">
                        <input type="date" id="start_date_picker" class="hidden-date-input" 
                               onchange="document.getElementById('start_date_text').value = this.value">
                        <input type="text" name="production_date_start" value="{{ production_date_start }}" 
                               placeholder="YYYY-MM-DD" id="start_date_text" onclick="openCalendar('start')">
                        <button type="button" class="calendar-btn" onclick="openCalendar('start')">ğŸ“…</button>
                    </div>
                    <span>~</span>
                    <div class="date-input-group">
                        <input type="date" id="end_date_picker" class="hidden-date-input" 
                               onchange="document.getElementById('end_date_text').value = this.value">
                        <input type="text" name="production_date_end" value="{{ production_date_end }}" 
                               placeholder="YYYY-MM-DD" id="end_date_text" onclick="openCalendar('end')">
                        <button type="button" class="calendar-btn" onclick="openCalendar('end')">ğŸ“…</button>
                    </div>
                </div>
            </div> -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            
            <!-- êµ¬ë¶„ì„  -->
            <div class="separator"></div>
            
            <!-- Row 3 -->
            <label class="form-label">â€¢ ì œì‘ìƒíƒœ</label>
            <div class="form-input">
                <input type="text" name="movie_state" id="movie_state_input" value="{{ movie_state }}" placeholder="ì œì‘ìƒíƒœ" onclick="openStatePopup()" style="background: white;">
            </div>
            
            <div></div> <!-- ê°„ê²© -->
            
            <label class="form-label">â€¢ ìœ í˜•</label>
            <div class="form-input">
                <input type="text" name="movie_type" id="movie_type_input" value="{{ movie_type }}" placeholder="ìœ í˜•" onclick="openTypePopup()" style="background: white;">
            </div>
            
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            
            <!-- Row 4 -->
            <label class="form-label">â€¢ ì¥ë¥´ë³„</label>
            <div class="form-input">
                <input type="text" name="genre" id="genre_input" value="{{ genre }}" placeholder="ì¥ë¥´" onclick="openGenrePopup()" style="background: white;">
            </div>
            
            <div></div> <!-- ê°„ê²© -->
            
            <label class="form-label">â€¢ êµ­ì ë³„</label>
            <div class="form-input">
                <input type="text" name="nation" id="nation_input" value="{{ nation }}" placeholder="ì œì‘êµ­ê°€" onclick="openNationPopup()" style="background: white;">
            </div>
            
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            <div></div> <!-- ë¹ˆ ê³µê°„ -->
            
            <!-- Row 5 - ì¸ë±ì‹± -->
            <div class="index-section">
                <label class="form-label">â€¢ ì˜í™”ëª… ì¸ë±ì‹±</label>
                <div class="index-links">
                    {% for ch in "ã„±ã„´ã„·ã„¹ã…ã…‚ã……ã…‡ã…ˆã…Šã…‹ã…Œã…ã…ABCDEFGHIJKLMNOPQRSTUVWXYZ" %}
                        <a href="?q={{ query }}&director={{ director }}&genre={{ genre }}&year_start={{ year_start }}&year_end={{ year_end }}&movie_state={{ movie_state }}&movie_type={{ movie_type }}&nation={{ nation }}&index={{ ch }}" 
                           {% if index == ch %}class="active"{% endif %}>{{ ch }}</a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </form>

    <div style="margin: 20px 0;">
        <span>ì´ <em class="fwb" style="font-weight: bold; font-style: normal;">{{ page_obj.paginator.count }}</em>ê±´</span>
    </div>

    <table class="results-table">
        <colgroup>
            <col style="width: 18%;"> <!-- ì˜í™”ëª… -->
            <col style="width: 15%;"> <!-- ì˜í™”ëª…(ì˜ë¬¸) -->
            <col style="width: 8%;">  <!-- ì˜í™”ì½”ë“œ -->
            <col style="width: 6%;">  <!-- ì œì‘ì—°ë„ -->
            <col style="width: 8%;">  <!-- ì œì‘êµ­ê°€ -->
            <col style="width: 8%;">  <!-- ìœ í˜• -->
            <col style="width: 12%;"> <!-- ì¥ë¥´ -->
            <col style="width: 8%;">  <!-- ì œì‘ìƒíƒœ -->
            <col style="width: 9%;">  <!-- ê°ë… -->
            <col style="width: 8%;">  <!-- ì œì‘ì‚¬ -->
        </colgroup>
        <thead>
            <tr>
                <th>ì˜í™”ëª…</th>
                <th>ì˜í™”ëª…(ì˜ë¬¸)</th>
                <th>ì˜í™”ì½”ë“œ</th>
                <th>ì œì‘ì—°ë„</th>
                <th>ì œì‘êµ­ê°€</th>
                <th>ìœ í˜•</th>
                <th>ì¥ë¥´</th>
                <th>ì œì‘ìƒíƒœ</th>
                <th>ê°ë…</th>
                <th>ì œì‘ì‚¬</th>
            </tr>
        </thead>
        <tbody>
            {% for movie in results %}
            <tr>
                <td>{{ movie.movie_name|default:""|safe  }}</td>
                <td>{{ movie.movie_engname|default:""|safe  }}</td>
                <td>{{ movie.mid|default:""|safe  }}</td>
                <td>{{ movie.create_year|default:""|safe  }}</td>
                <td>
                    {% for nation in movie.nations.all %}
                        {{ nation.nation|default:""|safe  }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        -
                    {% endfor %}
                </td>
                <td>{{ movie.movie_type }}</td>
                <td>
                    {% for genre in movie.genres.all %}{{ genre.genre|default:""|safe  }}{% if not forloop.last %}, {% endif %}{% endfor %}
                </td>
                <td>{{ movie.movie_state|default:""|safe }}</td>
                <td>
                    {% for casting in movie.castings.all %}
                        {{ casting.director.dname|default:""|safe  }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td>
                    {% for company in movie.companies.all %}
                        {{ company.company|default:""|safe  }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="10">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        <!-- ë§¨ ì²˜ìŒìœ¼ë¡œ -->
        {% if page_obj.has_previous %}
            <a href="?q={{ query }}&director={{ director }}&genre={{ genre }}&year_start={{ year_start }}&year_end={{ year_end }}&movie_state={{ movie_state }}&movie_type={{ movie_type }}&nation={{ nation }}&index={{ index }}&page=1" class="nav-btn">â‰ª</a>
        {% endif %}
        
        <!-- ì´ì „ í˜ì´ì§€ -->
        {% if page_obj.has_previous %}
            <a href="?q={{ query }}&director={{ director }}&genre={{ genre }}&year_start={{ year_start }}&year_end={{ year_end }}&movie_state={{ movie_state }}&movie_type={{ movie_type }}&nation={{ nation }}&index={{ index }}&page={{ page_obj.previous_page_number }}" class="nav-btn">â‰º</a>
        {% endif %}

        <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ì„ JavaScriptë¡œ ìƒì„± -->
        <div id="page-numbers"></div>

        <!-- ë‹¤ìŒ í˜ì´ì§€ -->
        {% if page_obj.has_next %}
            <a href="?q={{ query }}&director={{ director }}&genre={{ genre }}&year_start={{ year_start }}&year_end={{ year_end }}&movie_state={{ movie_state }}&movie_type={{ movie_type }}&nation={{ nation }}&index={{ index }}&page={{ page_obj.next_page_number }}" class="nav-btn">â‰»</a>
        {% endif %}

        <!-- ë§¨ ë§ˆì§€ë§‰ìœ¼ë¡œ -->
        {% if page_obj.has_next %}
            <a href="?q={{ query }}&director={{ director }}&genre={{ genre }}&year_start={{ year_start }}&year_end={{ year_end }}&movie_state={{ movie_state }}&movie_type={{ movie_type }}&nation={{ nation }}&index={{ index }}&page={{ page_obj.paginator.num_pages }}" class="nav-btn">â‰«</a>
        {% endif %}
    </div>

    <!-- DB ì¡°íšŒ ì‹œê°„ í‘œì‹œ -->
    <!-- <div class="query-info">
        <h4>DB ì¡°íšŒ ì •ë³´</h4>
        <p>ì´ ì‹¤í–‰ ì‹œê°„: {{ total_execution_time }}ms</p>
        <p>ì¿¼ë¦¬ ê°œìˆ˜: {{ query_count }}ê°œ</p>
        
        {% for query in query_info %}
            <div class="query-detail">
                <strong>ì¿¼ë¦¬ {{ forloop.counter }}:</strong> {{ query.time }}ms<br>
                <code>{{ query.sql }}</code>
            </div>
            <hr>
        {% endfor %}
    </div> -->
    {% if debug %}
    <div class="query-info">
        <p><strong>DB ì¡°íšŒ ì‹œê°„:</strong> {{ total_db_time }}ms (ì´ {{ query_count }}ê°œ ì¿¼ë¦¬)</p>
        <p><strong>ì´ ì²˜ë¦¬ ì‹œê°„:</strong> {{ query_time }}ms</p>
        <p><small>DEBUG ëª¨ë“œ: {% if debug %}ON{% else %}OFF{% endif %}</small></p>
        
        {% if query_info %}
            <details>
                <summary>SQL ì¿¼ë¦¬ ìƒì„¸ ì •ë³´ ({{ query_count }}ê°œ)</summary>
                {% for query in query_info %}
                    <div class="query-detail" style="margin: 10px 0; padding: 10px; border: 1px solid #ddd;">
                        <strong>ì¿¼ë¦¬ {{ query.number }}:</strong> {{ query.time }}ms<br>
                        <code style="background: #f5f5f5; padding: 5px; display: block; white-space: pre-wrap; font-size: 11px;">{{ query.sql }}</code>
                    </div>
                {% endfor %}
            </details>
        {% else %}
            <p><small>ì¿¼ë¦¬ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</small></p>
        {% endif %}
    </div>
    {% endif %}
    <!-- ì œì‘ìƒíƒœ ì„ íƒ íŒì—… -->
    <div id="statePopup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                ì½”ë“œê²€ìƒ‰ ê²°ê³¼
                <span class="popup-close" onclick="closeStatePopup()">&times;</span>
            </div>
            <div class="popup-body">
                <div class="select-all-section">
                    <div class="left-side">
                        <input type="checkbox" id="selectAllStates">
                        <label for="selectAllStates">ì „ì²´ ì„ íƒ</label>
                    </div>
                    <button type="button" class="confirm-btn" onclick="applyStateSelection()">í™•ì¸</button>
                </div>
                <table class="popup-table">
                    <thead>
                        <tr>
                            <th>ì„ íƒ</th>
                            <th>ì œì‘ìƒíƒœ</th>
                            <th>ì„ íƒ</th>
                            <th>ì œì‘ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for state in available_states %}
                            {% if forloop.counter0|divisibleby:2 %}
                                <tr>
                            {% endif %}
                            <td style="text-align: center;">
                                <input type="checkbox" value="{{ state }}" id="state_{{ state }}">
                            </td>
                            <td>
                                <label for="state_{{ state }}">{{ state }}</label>
                            </td>
                            {% if forloop.counter|divisibleby:2 or forloop.last %}
                                {% if forloop.last and not forloop.counter|divisibleby:2 %}
                                    <td></td>
                                    <td></td>
                                {% endif %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                <div style="float: right; margin-top: 10px;">
                    <button type="button" class="confirm-btn" onclick="applyStateSelection()">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìœ í˜• ì„ íƒ íŒì—… -->
    <div id="typePopup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                ì½”ë“œê²€ìƒ‰ ê²°ê³¼
                <span class="popup-close" onclick="closeTypePopup()">&times;</span>
            </div>
            <div class="popup-body">
                <div class="select-all-section">
                    <div class="left-side">
                        <input type="checkbox" id="selectAllTypes">
                        <label for="selectAllTypes">ì „ì²´ ì„ íƒ</label>
                    </div>
                    <button type="button" class="confirm-btn" onclick="applyTypeSelection()">í™•ì¸</button>
                </div>
                <table class="popup-table">
                    <thead>
                        <tr>
                            <th>ì„ íƒ</th>
                            <th>ìœ í˜•</th>
                            <th>ì„ íƒ</th>
                            <th>ìœ í˜•</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for type in available_types %}
                            {% if forloop.counter0|divisibleby:2 %}
                                <tr>
                            {% endif %}
                            <td style="text-align: center;">
                                <input type="checkbox" value="{{ type }}" id="type_{{ type }}">
                            </td>
                            <td>
                                <label for="type_{{ type }}">{{ type }}</label>
                            </td>
                            {% if forloop.counter|divisibleby:2 or forloop.last %}
                                {% if forloop.last and not forloop.counter|divisibleby:2 %}
                                    <td></td>
                                    <td></td>
                                {% endif %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                <div style="float: right; margin-top: 10px;">
                    <button type="button" class="confirm-btn" onclick="applyTypeSelection()">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¥ë¥´ ì„ íƒ íŒì—… -->
    <div id="genrePopup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                ì½”ë“œê²€ìƒ‰ ê²°ê³¼
                <span class="popup-close" onclick="closeGenrePopup()">&times;</span>
            </div>
            <div class="popup-body">
                <div class="select-all-section">
                    <div class="left-side">
                        <input type="checkbox" id="selectAllGenres">
                        <label for="selectAllGenres">ì „ì²´ ì„ íƒ</label>
                    </div>
                    <button type="button" class="confirm-btn" onclick="applyGenreSelection()">í™•ì¸</button>
                </div>
                <table class="popup-table">
                    <thead>
                        <tr>
                            <th>ì„ íƒ</th>
                            <th>ì¥ë¥´</th>
                            <th>ì„ íƒ</th>
                            <th>ì¥ë¥´</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for genre_item in available_genres %}
                            {% if forloop.counter0|divisibleby:2 %}
                                <tr>
                            {% endif %}
                            <td style="text-align: center;">
                                <input type="checkbox" value="{{ genre_item }}" id="genre_{{ genre_item }}">
                            </td>
                            <td>
                                <label for="genre_{{ genre_item }}">{{ genre_item }}</label>
                            </td>
                            {% if forloop.counter|divisibleby:2 or forloop.last %}
                                {% if forloop.last and not forloop.counter|divisibleby:2 %}
                                    <td></td>
                                    <td></td>
                                {% endif %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                <div style="float: right; margin-top: 10px;">
                    <button type="button" class="confirm-btn" onclick="applyGenreSelection()">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- êµ­ì  ì„ íƒ íŒì—… -->
    <div id="nationPopup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                ì½”ë“œê²€ìƒ‰ ê²°ê³¼
                <span class="popup-close" onclick="closeNationPopup()">&times;</span>
            </div>
            <div class="popup-body">
                <div class="select-all-section">
                    <div class="left-side">
                        <input type="checkbox" id="selectAllNations">
                        <label for="selectAllNations">ì „ì²´ ì„ íƒ</label>
                    </div>
                    <button type="button" class="confirm-btn" onclick="applyNationSelection()">í™•ì¸</button>
                </div>
                <table class="popup-table">
                    <thead>
                        <tr>
                            <th>ì„ íƒ</th>
                            <th>ì œì‘êµ­ê°€</th>
                            <th>ì„ íƒ</th>
                            <th>ì œì‘êµ­ê°€</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for nation_item in available_nations %}
                            {% if forloop.counter0|divisibleby:2 %}
                                <tr>
                            {% endif %}
                            <td style="text-align: center;">
                                <input type="checkbox" value="{{ nation_item }}" id="nation_{{ nation_item }}">
                            </td>
                            <td>
                                <label for="nation_{{ nation_item }}">{{ nation_item }}</label>
                            </td>
                            {% if forloop.counter|divisibleby:2 or forloop.last %}
                                {% if forloop.last and not forloop.counter|divisibleby:2 %}
                                    <td></td>
                                    <td></td>
                                {% endif %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                <div style="float: right; margin-top: 10px;">
                    <button type="button" class="confirm-btn" onclick="applyNationSelection()">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ë‹¬ë ¥ ì—´ê¸° í•¨ìˆ˜
    function openCalendar(type) {
        if (type === 'start') {
            document.getElementById('start_date_picker').showPicker();
        } else {
            document.getElementById('end_date_picker').showPicker();
        }
    }

    // ESC í‚¤ë¡œ íŒì—… ë‹«ê¸° ê¸°ëŠ¥
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            // í˜„ì¬ ì—´ë ¤ìˆëŠ” íŒì—… ì°¾ì•„ì„œ ë‹«ê¸°
            const openPopups = document.querySelectorAll('.popup-overlay');
            openPopups.forEach(popup => {
                if (popup.style.display === 'block') {
                    popup.style.display = 'none';
                    // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                    popup.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                }
            });
        }
    });

    // íŒì—… ë°°ê²½ í´ë¦­ì‹œ ë‹«ê¸° ê¸°ëŠ¥
    document.addEventListener('click', function(event) {
        if (event.target.classList.contains('popup-overlay')) {
            event.target.style.display = 'none';
            // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            event.target.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        }
    });

    // ì œì‘ìƒíƒœ íŒì—… í•¨ìˆ˜ë“¤
    function openStatePopup() {
        const popup = document.getElementById('statePopup');
        const input = document.getElementById('movie_state_input');
        
        // ì…ë ¥ í•„ë“œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        const rect = input.getBoundingClientRect();
        const popupContent = popup.querySelector('.popup-content');
        
        // íŒì—… ìœ„ì¹˜ ì„¤ì • (ì…ë ¥ í•„ë“œ ë°”ë¡œ ì•„ë˜)
        popupContent.style.left = rect.left + 'px';
        popupContent.style.top = (rect.bottom + 5) + 'px';
        popupContent.style.transform = 'none';
        
        popup.style.display = 'block';
        
        const selectedStates = input.value;
        if (selectedStates) {
            const states = selectedStates.split(',').map(t => t.trim());
            states.forEach(state => {
                const checkbox = document.getElementById('state_' + state);
                if (checkbox) checkbox.checked = true;
            });
        }
    }

    function closeStatePopup() {
        document.getElementById('statePopup').style.display = 'none';
        document.querySelectorAll('#statePopup input[type="checkbox"]').forEach(cb => cb.checked = false);
    }

    function applyStateSelection() {
        const checkedStates = [];
        document.querySelectorAll('#statePopup input[type="checkbox"]:checked:not(#selectAllStates)').forEach(cb => {
            checkedStates.push(cb.value);
        });
        document.getElementById('movie_state_input').value = checkedStates.join(', ');
        document.getElementById('movie_state_input').removeAttribute('readonly');
        closeStatePopup();
    }

    // ìœ í˜• íŒì—… í•¨ìˆ˜ë“¤
    function openTypePopup() {
        const popup = document.getElementById('typePopup');
        const input = document.getElementById('movie_type_input');
        
        // ì…ë ¥ í•„ë“œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        const rect = input.getBoundingClientRect();
        const popupContent = popup.querySelector('.popup-content');
        
        // íŒì—… ìœ„ì¹˜ ì„¤ì • (ì…ë ¥ í•„ë“œ ë°”ë¡œ ì•„ë˜)
        popupContent.style.left = rect.left + 'px';
        popupContent.style.top = (rect.bottom + 5) + 'px';
        popupContent.style.transform = 'none';
        
        popup.style.display = 'block';
        
        const selectedTypes = input.value;
        if (selectedTypes) {
            const types = selectedTypes.split(',').map(t => t.trim());
            types.forEach(type => {
                const checkbox = document.getElementById('type_' + type);
                if (checkbox) checkbox.checked = true;
            });
        }
    }

    function closeTypePopup() {
        document.getElementById('typePopup').style.display = 'none';
        document.querySelectorAll('#typePopup input[type="checkbox"]').forEach(cb => cb.checked = false);
    }

    function applyTypeSelection() {
        const checkedTypes = [];
        document.querySelectorAll('#typePopup input[type="checkbox"]:checked:not(#selectAllTypes)').forEach(cb => {
            checkedTypes.push(cb.value);
        });
        document.getElementById('movie_type_input').value = checkedTypes.join(', ');
        document.getElementById('movie_type_input').removeAttribute('readonly');
        closeTypePopup();
    }

    // ì¥ë¥´ íŒì—… í•¨ìˆ˜ë“¤
    function openGenrePopup() {
        const popup = document.getElementById('genrePopup');
        const input = document.getElementById('genre_input');
        
        // ì…ë ¥ í•„ë“œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        const rect = input.getBoundingClientRect();
        const popupContent = popup.querySelector('.popup-content');
        
        // íŒì—… ìœ„ì¹˜ ì„¤ì • (ì…ë ¥ í•„ë“œ ë°”ë¡œ ì•„ë˜)
        popupContent.style.left = rect.left + 'px';
        popupContent.style.top = (rect.bottom + 5) + 'px';
        popupContent.style.transform = 'none';
        
        popup.style.display = 'block';
        
        const selectedGenres = input.value;
        if (selectedGenres) {
            const genres = selectedGenres.split(',').map(t => t.trim());
            genres.forEach(genre => {
                const checkbox = document.getElementById('genre_' + genre);
                if (checkbox) checkbox.checked = true;
            });
        }
    }

    function closeGenrePopup() {
        document.getElementById('genrePopup').style.display = 'none';
        document.querySelectorAll('#genrePopup input[type="checkbox"]').forEach(cb => cb.checked = false);
    }

    function applyGenreSelection() {
        const checkedGenres = [];
        document.querySelectorAll('#genrePopup input[type="checkbox"]:checked:not(#selectAllGenres)').forEach(cb => {
            checkedGenres.push(cb.value);
        });
        document.getElementById('genre_input').value = checkedGenres.join(', ');
        document.getElementById('genre_input').removeAttribute('readonly');
        closeGenrePopup();
    }

    // êµ­ì  íŒì—… í•¨ìˆ˜ë“¤
    function openNationPopup() {
        const popup = document.getElementById('nationPopup');
        const input = document.getElementById('nation_input');
        
        // ì…ë ¥ í•„ë“œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        const rect = input.getBoundingClientRect();
        const popupContent = popup.querySelector('.popup-content');
        
        // íŒì—… ìœ„ì¹˜ ì„¤ì • (ì…ë ¥ í•„ë“œ ë°”ë¡œ ì•„ë˜)
        popupContent.style.left = rect.left + 'px';
        popupContent.style.top = (rect.bottom + 5) + 'px';
        popupContent.style.transform = 'none';
        
        popup.style.display = 'block';
        
        const selectedNations = input.value;
        if (selectedNations) {
            const nations = selectedNations.split(',').map(t => t.trim());
            nations.forEach(nation => {
                const checkbox = document.getElementById('nation_' + nation);
                if (checkbox) checkbox.checked = true;
            });
        }
    }

    function closeNationPopup() {
        document.getElementById('nationPopup').style.display = 'none';
        document.querySelectorAll('#nationPopup input[type="checkbox"]').forEach(cb => cb.checked = false);
    }

    function applyNationSelection() {
        const checkedNations = [];
        document.querySelectorAll('#nationPopup input[type="checkbox"]:checked:not(#selectAllNations)').forEach(cb => {
            checkedNations.push(cb.value);
        });
        document.getElementById('nation_input').value = checkedNations.join(', ');
        document.getElementById('nation_input').removeAttribute('readonly');
        closeNationPopup();
    }

    // ì „ì²´ ì„ íƒ ê¸°ëŠ¥ë“¤
    document.addEventListener('DOMContentLoaded', function() {
        // ì œì‘ìƒíƒœ ì „ì²´ ì„ íƒ
        const selectAllStates = document.getElementById('selectAllStates');
        if (selectAllStates) {
            selectAllStates.addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#statePopup input[type="checkbox"]:not(#selectAllStates)');
                checkboxes.forEach(cb => cb.checked = this.checked);
            });
        }

        // ìœ í˜• ì „ì²´ ì„ íƒ
        const selectAllTypes = document.getElementById('selectAllTypes');
        if (selectAllTypes) {
            selectAllTypes.addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#typePopup input[type="checkbox"]:not(#selectAllTypes)');
                checkboxes.forEach(cb => cb.checked = this.checked);
            });
        }

        // ì¥ë¥´ ì „ì²´ ì„ íƒ
        const selectAllGenres = document.getElementById('selectAllGenres');
        if (selectAllGenres) {
            selectAllGenres.addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#genrePopup input[type="checkbox"]:not(#selectAllGenres)');
                checkboxes.forEach(cb => cb.checked = this.checked);
            });
        }

        // êµ­ì  ì „ì²´ ì„ íƒ
        const selectAllNations = document.getElementById('selectAllNations');
        if (selectAllNations) {
            selectAllNations.addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#nationPopup input[type="checkbox"]:not(#selectAllNations)');
                checkboxes.forEach(cb => cb.checked = this.checked);
            });
        }
    });

    // í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± í•¨ìˆ˜
    document.addEventListener('DOMContentLoaded', function() {
        const currentPage = {{ page_obj.number }};
        const totalPages = {{ page_obj.paginator.num_pages }};
        const pageNumbersDiv = document.getElementById('page-numbers');
        
        // í˜„ì¬ í˜ì´ì§€ê°€ ì†í•œ 10ê°œ ê·¸ë£¹ì˜ ì‹œì‘/ë í˜ì´ì§€ ê³„ì‚°
        const currentGroup = Math.floor((currentPage - 1) / 10);
        const startPage = currentGroup * 10 + 1;
        const endPage = Math.min(startPage + 9, totalPages);
        
        // í˜ì´ì§€ ë²ˆí˜¸ë“¤ ìƒì„±
        for (let i = startPage; i <= endPage; i++) {
            if (i === currentPage) {
                const currentSpan = document.createElement('span');
                currentSpan.className = 'current';
                currentSpan.textContent = i;
                pageNumbersDiv.appendChild(currentSpan);
            } else {
                const pageLink = document.createElement('a');
                pageLink.href = `?q={{ query }}&director={{ director }}&genre={{ genre }}&year_start={{ year_start }}&year_end={{ year_end }}&movie_state={{ movie_state }}&movie_type={{ movie_type }}&nation={{ nation }}&index={{ index }}&page=${i}`;
                pageLink.textContent = i;
                pageNumbersDiv.appendChild(pageLink);
            }
        }
    });
    </script>
</body>
</html>